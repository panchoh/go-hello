name: Keeping Go up to date
on:
  schedule:
    - cron: 00 9 * * *
  pull_request:
    branches:
      - master
  push:
    branches:
      - master

jobs:
  fresh_go:
    runs-on: ubuntu-20.04
    steps:
      - name: Clone current repo
        uses: actions/checkout@v2
        with:
          ref: master

      - name: Ensure
        id: ensure-go
        uses: jmhodges/ensure-latest-go@v1.0.2

      - name: Compose a title for the PR
        id: pr-title
        run: |
          echo "##[set-output name=pr-title;]update to latest Go release ${{ steps.ensure-go.outputs.go_version}}"

      - name: Create pull request
        uses: peter-evans/create-pull-request@v2
        with:
          title: ${{ steps.pr-title.outputs.pr-title }}
          body: Auto-generated pull request created by the GitHub Actions [create-pull-request](https://github.com/peter-evans/create-pull-request) and [ensure-latest-go](https://github.com/jmhodges/ensure-latest-go).
          commit-message: ${{ steps.pr-title.outputs.pr-title }}
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: ensure-latest-go/patch-${{ steps.ensure-go.outputs.go_version }}
          base: master
